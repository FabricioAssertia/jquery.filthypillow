!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function g(b,c){var e=a.extend({},d.calendar,c.calendar||{});c.enable24HourTime&&!c.steps&&(c.steps=d.steps.slice(0,-1)),this.options=a.extend({},d,c),this.options.calendar=e,this.$element=b,this.setup()}function h(b,c){this.options=a.extend({},c),this.date=moment(),this.$element=b,this.currentTimeZone=null,this.$container=a('<div class="fp-cal-container"><div class="fp-cal-nav"><span class="fp-cal-left">&#9668;</span><span class="fp-cal-month"></span><span class="fp-cal-right">&#9658;</span></div><table><thead><tr class="fp-cal-days"></tr></thead><tbody class="fp-cal-dates"></tbody></div></div>'),this.$left=this.$container.find(".fp-cal-left"),this.$right=this.$container.find(".fp-cal-right"),this.$month=this.$container.find(".fp-cal-month"),this.$days=this.$container.find(".fp-cal-days"),this.$dates=this.$container.find(".fp-cal-dates"),this.$dateTemplate=a('<td class="fp-cal-date" data-date=""></td>'),this.$weekTemplate=a('<tr class="fp-cal-week"></tr>'),this.$dayLabelTemplate=a('<th class="fp-cal-day-label"></th>'),this.buildDayLabels()}var b="filthypillow",c="plugin_"+b,d={startStep:"day",minDateTime:null,maxDateTime:null,initialDateTime:null,enableCalendar:!0,steps:["month","day","year","hour","minute","meridiem"],exitOnBackgroundClick:!0,enable24HourTime:!1,minuteStepSize:15,calendar:{isPinned:!1,saveOnDateSelect:!1}},e=["show","hide","destroy","updateDateTime","updateDateTimeUnit","setTimeZone"],f=["getDate","isValid"];g.prototype={template:'<div class="fp-container"><div><div class="fp-calendar"><span class="fp-month fp-option"></span>/<span class="fp-day fp-option"></span>/<span class="fp-year fp-option"></span></div><div class="fp-clock"><span class="fp-hour fp-option"></span>:<span class="fp-minute fp-option"></span><span class="fp-meridiem fp-option"></span></div></div><div class="clearfix"><div class="fp-now"><button class="btn btn-block btn-default fp-now-button" type="button">Now</button></div><div class="fp-save"><button class="btn btn-block btn-primary fp-save-button" type="button">Save</button></div></div><div class="fp-description"></div><div class="fp-errors"></div><div class="fp-calendar-calendar"></div><div class="fp-current"></div><div class="fp-arrows"><span class="fp-arrow-up">&#9652;</span><span class="fp-arrow-down">&#9662;</span></div></div>',currentStep:null,dateTime:null,currentTimeZone:null,currentDigit:0,isActiveLeadingZero:0,stepRegExp:null,isError:!1,isActive:!1,setup:function(){this.steps=this.options.steps,this.stepRegExp=new RegExp(this.steps.join("|")),this.$window=a(window),this.$document=a(document),this.$body=a("body"),this.id="filthypillow-"+Math.round(1e3*Math.random()),this.$container=a(this.template),this.$container.attr("id",this.id),this.$calendar=this.$container.find(".fp-calendar"),this.$options=this.$container.find(".fp-option"),this.$month=this.$calendar.find(".fp-month"),this.$day=this.$calendar.find(".fp-day"),this.$year=this.$calendar.find(".fp-year"),this.$clock=this.$container.find(".fp-clock"),this.$hour=this.$clock.find(".fp-hour"),this.$minute=this.$clock.find(".fp-minute"),this.$meridiem=this.$clock.find(".fp-meridiem"),this.$errorBox=this.$container.find(".fp-errors"),this.$saveButton=this.$container.find(".fp-save-button"),this.$nowButton=this.$container.find(".fp-now-button"),this.$descriptionBox=this.$container.find(".fp-description"),this.$currentContainer=this.$container.find(".fp-current"),this.$arrowsContainer=this.$container.find(".fp-arrows"),this.$arrowUp=this.$container.find(".fp-arrow-up"),this.$arrowDown=this.$container.find(".fp-arrow-down"),this.options.enable24HourTime&&this.$meridiem.hide(),this.options.enableCalendar&&(this.calendar=new h(this.$container.find(".fp-calendar-calendar"),{minDateTime:this.options.minDateTime,maxDateTime:this.options.maxDateTime,onSelectDate:a.proxy(function(a,b,c,d){this.updateDateTimeUnit("month",b,!1),this.updateDateTimeUnit("date",c,!1),this.updateDateTimeUnit("year",a,!1),this.options.calendar.saveOnDateSelect&&d.activeDateClicked&&this.$saveButton.click()},this)})),this.setInitialDateTime()},showError:function(a,b){a&&this["$"+a]&&this["$"+a].addClass("fp-error fp-out-of-range"),this.$errorBox.text(b).show(),this.$saveButton.attr("disabled","disabled"),this.isError=!0},hideError:function(a,b){this.$container.find(".fp-error").removeClass("fp-error"),this.$errorBox.hide(),this.$saveButton.removeAttr("disabled","disabled"),this.isError=!1},activateSelectorTool:function(a){var b=this["$"+a];this.currentStep=a,this.$container.find(".active").unwrap(this.$currentContainer),this.$container.find(".active").removeClass("active"),b.addClass("active"),this.currentDigit=0,this.isActiveLeadingZero=0,this.options.enableCalendar&&("day"===a||"month"===a||"year"===a?this.calendar.show():this.options.calendar.isPinned||this.calendar.hide()),b.wrap(this.$currentContainer),b.after(this.$arrowsContainer)},to12Hour:function(a){return"PM"===this.dateTime.format("A")&&a>12?a-12:a},to24Hour:function(a){return"PM"===this.dateTime.format("A")&&a<12?a+12:"AM"===this.dateTime.format("A")&&a>11?a-12:a},formatToMoment:function(a,b){return"month"===a?b-1:b},formatFromMoment:function(a,b){return"month"===a?b+1:b},isValidDigitInput:function(a){if(a=parseInt(a,10),"month"===this.currentStep){if(a>12)return!1}else if("day"===this.currentStep&&a>this.dateTime.daysInMonth())return!1;return!0},updateDigit:function(a,b,c){var d,e,f=!1;if("meridiem"!==a){if("day"===a&&(a="date"),1===b&&0===c)return void(this.isActiveLeadingZero=1);if(b>1&&!this.isActiveLeadingZero?(e=this.dateTime.get(a),e="hour"===a?this.to12Hour(e):this.formatFromMoment(a,e),d=parseInt(e+""+c,10)):this.isActiveLeadingZero=0,d=d||c,"hour"===a?this.options.enable24HourTime||(d=this.to24Hour(d)):d=this.formatToMoment(a,d),!this.isValidDigitInput(d))return void(this.currentDigit===("year"==this.currentStep?4:2)&&(this.currentDigit=1));this.currentDigit===("year"==this.currentStep?4:2)?f=!0:"month"===a&&c>1?f=!0:"date"===a&&c>3?f=!0:"hour"===a&&(c>1&&!this.options.enable24HourTime||c>2)?f=!0:"minute"===a&&c>5&&(f=!0),this.updateDateTimeUnit(a,d,f)}},onOptionClick:function(b){var c=a(b.target),d=c.attr("class"),e=d.match(this.stepRegExp);e&&e.length&&this.activateSelectorTool(e[0])},onKeyUp:function(a){var b=a.keyCode||a.which;"meridiem"!==this.currentStep&&(8===b&&(this.currentDigit-=1),(b>=48&&b<=57||b>=96&&b<=105)&&(this.currentDigit+=1,this.updateDigit(this.currentStep,this.currentDigit,b%48)),this.currentDigit===("year"==this.currentStep?4:2)&&(this.currentDigit=0))},onKeyDown:function(a){var b=a.keyCode||a.which;switch(b){case 38:this.moveUp();break;case 40:this.moveDown();break;case 37:this.moveLeft();break;case 39:this.moveRight();break;case 65:"meridiem"===this.currentStep&&this.changeMeridiem("a");break;case 80:"meridiem"===this.currentStep&&this.changeMeridiem("p")}return a.shiftKey&&9===b?this.moveLeft():9===b&&this.moveRight(),13===b&&this.$saveButton.click(),!1},moveDown:function(){"meridiem"===this.currentStep?this.changeMeridiem():"minute"===this.currentStep?this.changeDateTimeUnit(this.currentStep,-1*parseInt(this.options.minuteStepSize)):this.currentStep&&this.changeDateTimeUnit(this.currentStep,-1),this.currentDigit=0},moveUp:function(){"meridiem"===this.currentStep?this.changeMeridiem():"minute"===this.currentStep?this.changeDateTimeUnit(this.currentStep,parseInt(this.options.minuteStepSize)):this.currentStep&&this.changeDateTimeUnit(this.currentStep,1),this.currentDigit=0},changeMeridiem:function(a){var b=parseInt(this.dateTime.format("H"),10)<12?12:-12;if(a)switch(a.toLowerCase()){case"a":b=b<0?b:0;break;case"p":b=b>0?b:0}this.changeDateTimeUnit("hour",b)},moveLeft:function(){if(this.currentStep){var a=this.steps.indexOf(this.currentStep);0===a?a=this.steps.length-1:a-=1,this.activateSelectorTool(this.steps[a])}},moveRight:function(){if(this.currentStep){var a=this.steps.indexOf(this.currentStep);a===this.steps.length-1?a=0:a+=1,this.activateSelectorTool(this.steps[a])}},onClickToExit:function(b){var c=a(b.target);/fp-/.test(c.attr("class"))||c.closest(this.$container).length||c.closest(this.$element).length||this.hide()},onSave:function(){this.isInRange(this.dateTime)&&this.$element.trigger("fp:save",[this.dateTime])},onNow:function(){this.setDateTime(new Date),this.renderDateTime(),this.dateChange()},addEvents:function(){this.$options.on("click",a.proxy(this.onOptionClick,this)),this.$saveButton.on("click",a.proxy(this.onSave,this)),this.$nowButton.on("click",a.proxy(this.onNow,this)),this.$document.on("keydown."+this.id,a.proxy(this.onKeyDown,this)),this.$document.on("keyup."+this.id,a.proxy(this.onKeyUp,this)),this.$arrowDown.on("click",a.proxy(this.moveDown,this)),this.$arrowUp.on("click",a.proxy(this.moveUp,this)),this.$document.on("scroll",a.proxy(this.hide,this)),this.options.exitOnBackgroundClick&&this.$window.on("click",a.proxy(this.onClickToExit,this))},removeEvents:function(){this.$options.off("click"),this.$saveButton.off("click"),this.$window.off("click."+this.id),this.$document.off("keydown."+this.id),this.$document.off("keyup."+this.id),this.$document.off("scroll")},setDateTime:function(a,b){this.dateTime=moment(a),this.options.enableCalendar&&this.calendar.setDate(this.dateTime),this.isInRange(this.dateTime)?this.isError&&this.hideError():this.showError(this.currentStep,"Date is out of range, please fix."),!this.isError&&b&&this.moveRight()},renderDateTime:function(){this.$year.text(this.dateTime.format("YYYY")),this.$month.text(this.dateTime.format("MM")),this.$day.text(this.dateTime.format("DD")),this.$hour.text(this.dateTime.format(this.options.enable24HourTime?"HH":"hh")),this.$minute.text(this.dateTime.format("mm")),this.options.enable24HourTime||this.$meridiem.text(this.dateTime.format("A")),this.$descriptionBox.text(this.dateTime.format("LLLL"))},setInitialDateTime:function(){var a=moment();a.format("m");a.zone(this.currentTimeZone),"function"==typeof this.options.initialDateTime&&(a=this.options.initialDateTime(a.clone())),this.updateDateTime(a)},isInRange:function(a){var b="function"==typeof this.options.minDateTime&&this.options.minDateTime(),c="function"==typeof this.options.maxDateTime&&this.options.maxDateTime(),d=right=!1;return b&&(b.zone(this.currentTimeZone),d=a.diff(b,"second")<0),c&&(c.zone(this.currentTimeZone),right=a.diff(c,"second")>0),!(right||d)},setTimeZone:function(a){this.dateTime.zone(a),this.currentTimeZone=a,this.options.enableCalendar&&this.calendar.setTimeZone(a)},dateChange:function(){this.options.enableCalendar&&(this.calendar.setDate(this.dateTime),"day"!==this.currentStep&&"month"!==this.currentStep&&"year"!==this.currentStep||this.calendar.render()),this.$element.trigger("fp:datetimechange",[this.dateTime])},changeDateTimeUnit:function(a,b){var c=this.dateTime.clone().add(b,a+"s"),d=this.isInRange(c);this.isError||d?d&&this.hideError():this.showError(this.currentStep,"Date is out of range, please fix."),this.dateTime.add(b,a+"s"),this.renderDateTime(),this.dateChange()},updateDateTimeUnit:function(a,b,c){var d=this.dateTime.clone().set(a,b);this.updateDateTime(d,c)},getDate:function(){return this.dateTime.clone()},isValid:function(){return!this.isError},updateDateTime:function(a,b){this.setDateTime(a,b),this.renderDateTime(),this.dateChange()},checkPositionInterval:null,clearCheckPositionInterval:function(){null!=this.checkPositionInterval&&clearInterval(this.checkPositionInterval),this.checkPositionInterval=null},currentPosition:{top:null,left:null},positionElement:function(){var a=this.currentPosition.top;this.$window.scrollTop()+this.$window.height()<this.currentPosition.top+this.$container.height()&&(a=this.currentPosition.top-this.$container.height()-this.$element.height());var b=this.currentPosition.left;this.$window.scrollLeft()+this.$window.width()<this.currentPosition.left+this.$container.width()&&(b=this.$window.width()-this.$container.width()),this.$container.css({left:b+"px",top:a+"px"})},getElementPosition:function(){var a=this.$element.offset();return{top:a.top+this.$element.height(),left:a.left}},show:function(){this.isActive||(this.setInitialDateTime(),this.clearCheckPositionInterval(),a("body").prepend(this.$container),this.$container.hide(),this.checkPositionInterval=setInterval(function(){if(!a(this.$element).is(":visible"))return this.hide();var b=this.getElementPosition();this.$container.show(),this.currentPosition=b,this.positionElement()}.bind(this),250),this.activateSelectorTool(this.options.startStep),this.addEvents(),this.isActive=!0)},hide:function(){this.clearCheckPositionInterval(),this.currentPosition.left=this.currentPosition.top=null,this.isActive&&(this.$container.remove(),this.removeEvents(),this.isActive=!1,this.$element.trigger("fp:hide",[this.dateTime]))},destroy:function(){this.clearCheckPositionInterval(),this.currentPosition.left=this.currentPosition.top=null,this.removeEvents(),this.$container.remove(),this.isActive=!1,this.$element.removeData(c)}},h.prototype.setDate=function(a){this.date=a.clone()},h.prototype.removeEvents=function(){this.$right.off("click"),this.$left.off("click"),this.$dates.find(".fp-cal-date:not( .fp-disabled )").off("click")},h.prototype.addEvents=function(){this.$right.on("click",a.proxy(this.nextMonth,this)),this.$left.on("click",a.proxy(this.prevMonth,this)),this.$dates.find(".fp-cal-date:not( .fp-disabled )").on("click",a.proxy(this.onSelectDate,this))},h.prototype.toggleMonthArrows=function(){this.isInMinRange(this.date.clone().subtract(1,"month").endOf("month"))?this.$left.show():this.$left.hide(),this.isInMaxRange(this.date.clone().add(1,"month").date(1))?this.$right.show():this.$right.hide()},h.prototype.nextMonth=function(){this.date.add(1,"month"),this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date")),this.render()},h.prototype.prevMonth=function(){this.date.subtract(1,"month"),this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date")),this.render()},h.prototype.nextYear=function(){this.date.add(1,"year"),this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date")),this.render()},h.prototype.prevYear=function(){this.date.subtract(1,"year"),this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date")),this.render()},h.prototype.selectDate=function(a,b,c,d){"function"==typeof this.options.onSelectDate&&this.options.onSelectDate(a,b,c,d||{}),this.highlightDate(c)},h.prototype.onSelectDate=function(b){var c=a(b.target),d=parseInt(c.attr("data-add-month"),10);this.date.add(d,"month"),this.selectDate(this.date.get("year"),this.date.get("month"),c.attr("data-date"),{activeDateClicked:!d})},h.prototype.highlightDate=function(a){this.$dates.find(".active").removeClass("active"),this.$dates.find(".fp-cal-date-"+a).addClass("active")},h.prototype.buildTemplate=function(){this.$month.text(this.date.format("MMMM YYYY")).attr("data-month",this.date.get("month")+1),this.toggleMonthArrows(),this.buildDates(),this.disableOutOfRangeDates(),this.highlightDate(this.date.get("date"))},h.prototype.isInMinRange=function(a){if("function"!=typeof this.options.minDateTime)return!0;var b=this.options.minDateTime();return b.zone(this.currentTimeZone),a.diff(b,"second")>0},h.prototype.isInMaxRange=function(a){if("function"!=typeof this.options.maxDateTime)return!0;var b=this.options.maxDateTime();return b.zone(this.currentTimeZone),a.diff(b,"second")<0},h.prototype.disableOutOfRangeDates=function(){var c,d,b=this;"function"!=typeof b.options.maxDateTime&&"function"!=typeof b.options.minDateTime||this.$dates.find(".fp-cal-date").filter(function(){return c=b.date.clone(),d=a(this),d.attr("data-add-month")&&c.add(parseInt(d.attr("data-add-month"),10),"month"),c.date(parseInt(a(this).attr("data-date"),10)),!(b.isInMinRange(c)&&b.isInMaxRange(c))}).addClass("fp-disabled")},h.prototype.buildDayLabels=function(){for(var a=this.date.clone(),b=0;b<7;++b)this.$dayLabelTemplate.clone().text(a.day(b).format("ddd")).appendTo(this.$days)},h.prototype.buildDates=function(){var h,a=this.date.daysInMonth(),b=this.date.clone(),c=this.date.clone().subtract(1,"month").endOf("month").date(),d=this.$weekTemplate.clone(),e=b.date(1).weekday(),f=b.date(a).weekday();for(this.$dates.empty(),h=0;h<e;++h)this.$dateTemplate.clone().attr("data-add-month",-1).attr("data-date",c-h).addClass("fp-cal-date-prev-"+c-h).addClass("fp-not-in-month").text(c-h).prependTo(d);for(h=1;h<=7-e;++h)this.$dateTemplate.clone().addClass("fp-cal-date-"+h).attr("data-date",h).text(h).appendTo(d);for(d.appendTo(this.$dates),d=this.$weekTemplate.clone(),d.appendTo(this.$dates);h<=a;++h)(h+e-1)%7==0&&(d=this.$weekTemplate.clone(),d.appendTo(this.$dates)),this.$dateTemplate.clone().addClass("fp-cal-date-"+h).attr("data-date",h).text(h).appendTo(d);for(h=1;h<7-f;++h)this.$dateTemplate.clone().addClass("fp-cal-date-next-"+h).attr("data-add-month",1).attr("data-date",h).addClass("fp-not-in-month").text(h).appendTo(d)},h.prototype.render=function(){this.buildTemplate(),this.removeEvents(),this.addEvents()},h.prototype.show=function(){this.render(),this.$container.appendTo(this.$element)},h.prototype.hide=function(){this.$container.remove(),this.removeEvents()},h.prototype.get=function(){return this.$container},h.prototype.setTimeZone=function(a){this.currentTimeZone=a},a.fn[b]=function(b){var d,h=Array.prototype.slice.call(arguments),b=b||{};return"string"===(typeof b).toLowerCase()&&~a.inArray(b,f)?this.data(c)[b].apply(this.data(c),h.slice(1,h.length)):this.each(function(){if(d=a(this),d.data(c)||"object"!==(typeof b).toLowerCase()){if("string"===(typeof b).toLowerCase()){if(!~a.inArray(b,e))throw new Error("Method "+b+" does not exist. Did you instantiate filthypillow?");d.data(c)[b].apply(d.data(c),h.slice(1,h.length))}}else d.data(c,new g(d,b))})}});